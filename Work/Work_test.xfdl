<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="Work_test" width="1280" height="720" titletext="New Form">
    <Layouts>
      <Layout height="720" width="1280">
        <Button id="Button05" taborder="0" text="버튼" left="21" top="495" width="120" height="50" cssclass="btn_primary"/>
        <Button id="Button04_00_00_01" taborder="1" text="버튼" left="160" top="500" width="120" height="50" cssclass="btn_category_blue"/>
        <Button id="Button04_00_00_01_00" taborder="2" text="안녕하세요" left="21" top="560" width="120" height="50" cssclass="btn_category_green"/>
        <Button id="Button04_00_00_01_01" taborder="3" text="버튼" left="160" top="560" width="120" height="50" cssclass="btn_category_purple"/>
        <Button id="Button04_00_00_01_02" taborder="4" text="버튼" left="21" top="625" width="120" height="50" cssclass="btn_category_orange"/>
        <Button id="Button04_00_00_01_04" taborder="5" text="버튼" left="20" top="10" width="120" height="50" cssclass="btn_primary"/>
        <Button id="Button04_00_00_01_05" taborder="6" text="버튼" left="160" top="10" width="120" height="50" cssclass="btn_secondary"/>
        <Button id="Button04_00_00_01_05_00" taborder="7" text="버튼" left="20" top="70" width="120" height="50" cssclass="btn_outline"/>
        <Button id="Button04_00_00_01_05_01" taborder="8" text="버튼" left="160" top="75" width="120" height="50" cssclass="btn_text"/>
        <Button id="Button04_00_00_01_05_02" taborder="9" text="버튼" left="20" top="140" width="120" height="50" cssclass="btn_danger"/>
        <Button id="Button04_00_00_01_05_03" taborder="10" text="버튼" left="160" top="135" width="120" height="60" cssclass="btn_large" onclick="Button04_00_00_01_05_03_onclick"/>
        <Button id="Button04_00_00_01_05_02_00" taborder="11" text="버튼" left="20" top="205" width="120" height="50" cssclass="btn_small"/>
        <Button id="Button04_00_00_01_05_02_01" taborder="12" text="버튼" left="160" top="200" width="120" height="50" cssclass="btn_chip"/>
        <Button id="Button04_00_00_01_05_02_00_00" taborder="13" text="버튼" left="20" top="270" width="120" height="50" cssclass="btn_success"/>
        <Grid id="Grid00" taborder="14" left="333" top="20" width="257" height="270" binddataset="ds_category" autoenter="none" autofittype="col" cssclass="grd_default">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="80"/>
                <Column size="80"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head" cssclass="grd_header">
                <Cell text="CATEGORY_ID"/>
                <Cell col="1" text="CATEGORY_NAME"/>
              </Band>
              <Band id="body" cssclass="grd_body">
                <Cell text="bind:CATEGORY_ID"/>
                <Cell col="1" text="bind:CATEGORY_NAME"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="Static00" taborder="15" left="993" top="32" height="41" cssclass="sta_cm_box05" width="257"/>
        <Static id="stCalc" taborder="16" left="990" top="32" height="41" width="257"/>
        <Static id="Static04" taborder="17" left="990" top="67" cssclass="sta_WF_box03" width="250" bottom="334"/>
        <Button id="Button00" taborder="18" text="7" left="1004" top="172" width="48" height="48" cssclass="btn_WF_calculatorNum" onclick="fn_callNumOnClick"/>
        <Button id="Button01" taborder="19" text="8" left="1064" top="172" width="48" height="48" cssclass="btn_WF_calculatorNum" onclick="fn_callNumOnClick"/>
        <Button id="Button02" taborder="20" text="9" left="1120" top="172" width="48" height="48" cssclass="btn_WF_calculatorNum" onclick="fn_callNumOnClick"/>
        <Button id="Button03" taborder="21" text="6" left="1120" top="225" width="48" height="48" cssclass="btn_WF_calculatorNum" onclick="fn_callNumOnClick"/>
        <Button id="Button04" taborder="22" text="4" left="1004" top="225" width="48" height="48" cssclass="btn_WF_calculatorNum" onclick="fn_callNumOnClick"/>
        <Button id="Button05_00" taborder="23" text="5" left="1064" top="225" width="48" height="48" cssclass="btn_WF_calculatorNum" onclick="fn_callNumOnClick"/>
        <Button id="Button06" taborder="24" text="3" left="1120" top="278" width="48" height="48" cssclass="btn_WF_calculatorNum" onclick="fn_callNumOnClick"/>
        <Button id="Button07" taborder="25" text="1" left="1004" top="278" width="48" height="48" cssclass="btn_WF_calculatorNum" onclick="fn_callNumOnClick"/>
        <Button id="Button08" taborder="26" text="2" left="1064" top="278" width="48" height="48" cssclass="btn_WF_calculatorNum" onclick="fn_callNumOnClick"/>
        <Button id="btnBack" taborder="27" left="1004" top="119" width="48" height="48" cssclass="btn_WF_calculatorBack" onclick="fn_comBtnOnClick" text=""/>
        <Button id="Button10" taborder="28" text="0" left="1004" top="331" width="108" height="48" cssclass="btn_WF_calculatorNum" onclick="fn_callNumOnClick"/>
        <Button id="btn_culator" taborder="29" text="." left="1120" top="331" width="48" height="48" cssclass="btn_WF_calculatorNum" onclick="fn_comBtnOnClick"/>
        <Button id="btnDivision" taborder="30" top="119" width="48" height="48" cssclass="btn_WF_division" onclick="fn_comBtnOnClick" left="1178" text="%"/>
        <Button id="btnMultiple" taborder="31" left="1178" top="172" width="48" height="48" cssclass="btn_WF_multiple" onclick="fn_comBtnOnClick" text="X"/>
        <Button id="btnMinus" taborder="32" left="1178" top="225" width="48" height="48" cssclass="btn_WF_minus" onclick="fn_comBtnOnClick" text="-"/>
        <Button id="btnPlus" taborder="33" left="1178" top="278" width="48" cssclass="btn_WF_plus" height="48" onclick="fn_comBtnOnClick" text="+"/>
        <Button id="btnAnd" taborder="34" left="1178" top="331" width="48" cssclass="btn_WF_result" height="48" onclick="fn_comBtnOnClick" text="="/>
        <Button id="btnCE" taborder="35" text="CE" left="1062" top="119" width="48" height="48" cssclass="btn_WF_calculatorNum" font="18px &quot;Arial&quot;" onclick="fn_comBtnOnClick"/>
        <Button id="btnC" taborder="36" text="C" left="1120" top="119" width="48" height="48" cssclass="btn_WF_calculatorNum" font="18px &quot;Arial&quot;" onclick="fn_comBtnOnClick"/>
        <Static id="stNum" taborder="37" text="0" left="990" top="67" height="46" cssclass="sta_WF_calculatorTotal" width="250" background="#ffffff" border="1px solid silver" textAlign="right" padding="0px 10px 0px 0px" font="normal 700 20pt/normal &quot;gothic&quot;,&quot;Gulim&quot;"/>
        <Button id="btnClose" taborder="38" top="33" width="30" height="30" cssclass="btn_WF_noteDel" right="39" onclick="fn_comBtnOnClick"/>
        <Button id="btnMove" taborder="39" top="50" width="29" height="29" cssclass="btn_WF_widgetMove04" left="983"/>
        <Static id="Static01" taborder="40" text="안녕" left="350" top="325" width="120" height="60" cssclass="sta_default"/>
        <Div id="Div00" taborder="41" text="Div00" left="310" top="500" width="90" height="75" cssclass="div_default"/>
        <Static id="Static01_00" taborder="42" text="안녕" left="480" top="331" width="120" height="60" cssclass="sta_title"/>
        <Static id="Static01_01" taborder="43" text="안녕" left="610" top="336" width="120" height="60" cssclass="sta_subtitle"/>
        <Static id="Static01_02" taborder="44" text="안녕" left="350" top="379" width="120" height="60" cssclass="sta_label"/>
        <Static id="Static01_03" taborder="45" text="안녕" left="470" top="380" width="120" height="60" cssclass="sta_description"/>
        <Static id="Static01_03_00" taborder="46" text="안녕" left="340" top="440" width="120" height="60" cssclass="sta_primary"/>
        <Static id="Static01_03_01" taborder="47" text="안녕" left="480" top="440" width="120" height="60" cssclass="sta_error"/>
        <Static id="Static01_03_02" taborder="48" text="안녕" left="610" top="380" width="120" height="60" cssclass="sta_caption"/>
        <Static id="Static01_03_01_00" taborder="49" text="안녕" left="600" top="430" width="120" height="60" cssclass="sta_success"/>
        <Static id="Static01_03_01_01" taborder="50" text="안녕" left="680" top="319" width="120" height="60" cssclass="sta_warning" onclick="Static01_03_01_01_onclick"/>
        <Static id="Static01_03_01_02" taborder="51" text="안녕" left="660" top="379" width="120" height="60" cssclass="sta_badge"/>
        <Static id="Static01_03_01_03" taborder="52" text="안녕" left="660" top="449" width="120" height="60" cssclass="sta_badge_danger"/>
        <Static id="Static01_03_01_03_00" taborder="53" text="안녕" left="800" top="325" width="120" height="60" cssclass="sta_number"/>
        <Static id="Static01_03_01_03_01" taborder="54" text="안녕" left="780" top="380" width="120" height="60" cssclass="sta_price"/>
        <Static id="Static01_03_01_03_02" taborder="55" text="안녕" left="530" top="510" width="120" height="60" cssclass="sta_blue_bg"/>
        <Static id="Static01_03_01_03_03" taborder="56" text="안녕" left="960" top="495" width="120" height="60" cssclass="stc_POS_Label"/>
        <Static id="Static01_03_01_03_04" taborder="57" text="안녕" left="530" top="575" width="120" height="60" cssclass="sta_dark_blue_bg" onclick="Static01_03_01_03_04_onclick"/>
        <Static id="Static01_03_01_03_05" taborder="58" text="안녕" left="660" top="575" width="120" height="60" cssclass="sta_blue_badge"/>
        <Static id="Static01_03_01_03_04_00" taborder="59" text="안녕" left="530" top="640" width="120" height="60" cssclass="sta_dark_blue_bg"/>
        <Static id="Static01_03_01_03_04_01" taborder="60" text="안녕" left="660" top="645" width="120" height="60" cssclass="sta_dark_blue_bg"/>
        <Static id="Static01_03_01_03_05_00" taborder="61" text="안녕" left="800" top="439" width="120" height="60" cssclass="sta_blue_card"/>
        <Static id="Static01_03_01_03_05_00_00" taborder="62" text="안녕" left="800" top="509" width="120" height="60" cssclass="sta_light_blue_border"/>
        <Static id="Static01_03_01_03_05_00_01" taborder="63" text="안녕" left="800" top="580" width="120" height="60" cssclass="sta_light_blue_border"/>
        <Static id="Static01_03_01_03_05_00_02" taborder="64" text="안녕" left="800" top="645" width="120" height="60" cssclass="sta_dark_blue_border"/>
        <Div id="Div01" taborder="65" text="Div01" left="310" top="590" width="90" height="75" cssclass="div_blue_bg"/>
        <Div id="Div02" taborder="66" text="Div02" left="425" top="510" width="90" height="60" cssclass="div_card_shadow"/>
        <Static id="Static02" taborder="67" text="Static02" left="960" top="585" width="120" height="60" cssclass="stc_POS_Title"/>
        <Button id="Button09" taborder="68" text="버튼" left="21" top="330" width="120" height="50" cssclass="btn_primary_clean"/>
        <Button id="Button11" taborder="69" text="버튼" left="160" top="273" width="120" height="50" cssclass="btn_login"/>
        <Button id="Button12" taborder="70" text="버튼" left="160" top="329" width="120" height="50" cssclass="btn_sub"/>
        <Button id="Button13" taborder="71" text="버튼" left="21" top="389" width="120" height="50" cssclass="btn_text_only"/>
        <Button id="Button14" taborder="72" text="버튼" left="160" top="386" width="120" height="50" cssclass="btn_WF_FillRed"/>
        <Button id="Button14_00" taborder="73" text="버튼" left="160" top="444" width="120" height="50" cssclass="btn_WF_FillGreen"/>
        <Static id="Static03" taborder="74" text="defaultRight 오른쪽 정렬" left="730" top="250" width="170" height="60" cssclass="sta_defaultRight"/>
        <Static id="Static05" taborder="75" text="titleRight오른쪽정렬" left="700" top="196" width="220" height="60" cssclass="sta_titleRight"/>
        <Grid id="Grid01" taborder="76" left="620" top="23" width="80" height="143" binddataset="Dataset0" cssclass="grd_POS">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="80"/>
                <Column size="80"/>
              </Columns>
              <Rows>
                <Row band="head" size="24"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="DEPT_CODE"/>
                <Cell col="1" text="DEPT_NAME"/>
              </Band>
              <Band id="body">
                <Cell text="bind:DEPT_CODE"/>
                <Cell col="1" text="bind:DEPT_NAME"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Div id="Div03" taborder="77" text="Div03" left="918" top="273" width="200" height="150" cssclass="div_POS_Table"/>
        <Static id="Static06" taborder="78" text="1번" left="1123" top="580" width="120" height="60" cssclass="sta_POS_TableNum"/>
        <Static id="Static07" taborder="79" text="Static07" left="160" top="630" width="120" height="60" cssclass="stc_Footer_Info"/>
        <Static id="Static08" taborder="80" text="Static08" left="400" top="635" width="120" height="60" cssclass="stc_Footer_Sub"/>
        <Div id="Div04" taborder="81" text="Div04" left="940" top="106" width="200" height="150" cssclass="div_POS_Card_Empty"/>
        <Grid id="Grid02" taborder="82" left="720" top="18" width="220" height="165" cssclass="grd_Retiree" binddataset="Dataset0">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="80"/>
                <Column size="80"/>
              </Columns>
              <Rows>
                <Row band="head" size="24"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="DEPT_CODE"/>
                <Cell col="1" text="DEPT_NAME"/>
              </Band>
              <Band id="body">
                <Cell text="bind:DEPT_CODE"/>
                <Cell col="1" text="bind:DEPT_NAME"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
      </Layout>
    </Layouts>
    <Script type="xscript5.1"><![CDATA[this.fvPushNum      = 0;    // 숫자를 누른 상태
this.fvPushOperator = 1;    // 연산자를(+,-,*,/) 누른 상태
this.fvPushEqual    = 2;    // '='를 누른 상태
this.fvIsDecimalPoint;      // 소수점여부
this.fvNumber;              // 출력장체 표시된 숫자
this.fvResult;              // 연산 결과
this.fvResultText;              // 연산 결과 텍스트
this.fvMemory;              // 메모리 저장 변수
this.fvIdxDecimalPoint;     // 소수점 Index
this.fvPreOperator;         // 이전에 누른 연산자
this.fvChkStatus;           // 숫자,'=',연산자 상태 변수
this.fvFlagMemory;          // 메모리 사용 상태
this.fvIsPushDot;           // 소수점를 누른 상태

this.commCalc_onload = function(obj:nexacro.Form,e:nexacro.LoadEventInfo)
{
	this.fnSetC();
};

this.fn_comBtnOnClick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	switch (obj.name)
	{
		case "btnDivision" :
			this.fnCalculate("/");
			break;
			
		case "btnMultiple" :
			this.fnCalculate("*");
			break;
			
		case "btnMinus" :
			this.fnCalculate("-");
			break;
			
		case "btnPlus" :
			this.fnCalculate("+");
			break;
		
		case "btnAnd" :
			this.fnCalculate("=");
			break;
			
		case "btnBack" :
			this.fnSetBackspace();
			break;
			
		case "btnCE" :
			this.fnSetCE();
			break;
			
		case "btnC" :
			this.fvResultText = "";
			this.stCalc.text = "";
			this.fnSetC();		
			break;
			
		case "btn_culator" :
			this.fvIsDecimalPoint = true;
			this.fvIsPushDot = true;			
			break;
			
		case "btnClose" :
			this.parent.parent.fnCloseWidget(this.parent);
			break;
	}
};

this.fn_callNumOnClick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.fnSetNum(obj.text);
};

this.fnSetNum = function(pushNumber)
{
    if (this.fvChkStatus == this.fvPushOperator || this.fvFlagMemory == true) { // 직전에 fvPushOperator 또는 메모리 관련 버튼을 누른 상태
        this.fnSetCE();
    } else if (this.fvChkStatus == this.fvPushEqual) { // 직전에 '='를 누른 상태
        this.fnSetC();
    }
    
    this.fvFlagMemory = false;
    
    let prevString = this.stNum.text;

    if (this.fvIsDecimalPoint == true && this.fvIsPushDot == true) 
	{
        this.stNum.text = prevString + pushNumber;
    }
    else
    {
        if (prevString.charAt(0) == "0") { // 초기'0.'인 상태에선 '0'을 삭제하고 'pushNumber.'으로 세팅
             this.stNum.text = pushNumber + prevString.substr(1);
        } else { // '.'의 position으로 pushNumber Add처리
           let vBefore = prevString.substr(0, this.fvIdxDecimalPoint);
           let vAfter = prevString.substr(this.fvIdxDecimalPoint);
           this.stNum.text = vBefore + pushNumber + vAfter;
           this.fvIdxDecimalPoint++;
        }
    }
    
     this.fvNumber = this.stNum.text;
    
    if (this.fvNumber.indexOf(".") ==  this.fvNumber.length-1) {
         this.fvNumber = nexacro.toNumber(this.fvNumber);
    } else {
        this. fvNumber = nexacro.toNumber(this.fvNumber.substr(0, this.fvNumber.length));
    }
    
     this.fvChkStatus = this.fvPushNum;
};

this.fnCalculate = function(pushOperator)
{
    // 입력받은 연산자 저장, 연산은 하지 않는다. (직전에 숫자가 입력되지 않은 경우)
    if (this.fvChkStatus!=this.fvPushNum)
    {
        if (pushOperator == "+" || pushOperator == "-" || pushOperator == "*" || pushOperator == "/") {
            this.fvPreOperator = pushOperator;
            this.fvChkStatus   = this.fvPushOperator;
            
			return;
        }
    }
    
    // 직전에 입력받은 연산자에 따라 연산을 수행, 입력받은 연산자 저장
    switch (this.fvPreOperator)
    {    
        case '+':
            this.fvResult += this.fvNumber;
			this.fvResultText = this.fvResultText + " + " + this.fvNumber;
            break;
        
		case '-':
            this.fvResult -= this.fvNumber;
			this.fvResultText = this.fvResultText + " - " + this.fvNumber;
            break;
        
		case '*':
            this.fvResult *= this.fvNumber;
			this.fvResultText = this.fvResultText + " * " + this.fvNumber;
            break;
        
		case '/':
            this.fvResult /= this.fvNumber;
			this.fvResultText = this.fvResultText + " / " + this.fvNumber;
            break;
        
		default:
            this.fvResult = this.fvNumber;
			this.fvResultText = this.fvNumber;
            break;
    }
	
	let vIdxPoint = this.fvResult.toString().substr(this.fvIdxDecimalPoint);
	let resultText = this.fvResult;
    
    this.stNum.text = resultText.toString();
	this.stCalc.text = this.fvResultText;
	
    // 연산자 및 상태 저장
    if (pushOperator == "=") {
        this.fvChkStatus = this.fvPushEqual;
    } else {
        this.fvPreOperator = pushOperator;
        this.fvChkStatus = this.fvPushOperator;
        this.fvNumber = nexacro.toNumber(this.stNum.text.text);
    }
};

/*----------------------------------------------------------------------------------------------
 * 설명 : 계산 결과 삭제
 ----------------------------------------------------------------------------------------------*/
this.fnSetC = function()
{
    this.fnSetCE();
    
    this.fvNumber = 0;
    this.fvResult = 0;
    this.fvPreOperator = " ";
    this.fvChkStatus = this.fvPushNum;
};

/*----------------------------------------------------------------------------------------------
 * 설명 : 출력된 결과 삭제
 ----------------------------------------------------------------------------------------------*/
this.fnSetCE = function() 
{
    this.stNum.text = "0";
	
	// '.'를 누른 상태
    if (this.fvIsPushDot) {
        this.fvIsDecimalPoint = true;
	} else {
        this.fvIsDecimalPoint = false;
	}
    
    this.fvIdxDecimalPoint = 1;
};

this.fnSetBackspace = function()
{
    if (this.fvChkStatus == this.fvPushNum)
    {
        let resultText = this.stNum.text;
    
        // 소수점인 경우
        if (this.fvIsDecimalPoint)
        {
            resultText = resultText.substr(0, resultText.length-1);
            this.stNum.text = resultText;
    
            if (resultText.charAt(resultText.length-2) == ".") {
                this.fvIsDecimalPoint = false;
			}
        }
        else
        {
            resultText = resultText.substr(0, resultText.length-2) + ".";
            
			this.fvIdxDecimalPoint--;
            this.stNum.text = resultText;
        }

        if (resultText.length == 1) {
            this.fnSetCE();
        }
        
        this.fvNumber = nexacro.toNumber(this.stNum.text);
        this.fvChkStatus = this.fvPushNum;
    }
};

]]></Script>
    <Objects>
      <Dataset id="ds_category">
        <ColumnInfo>
          <Column id="CATEGORY_ID" type="STRING" size="256"/>
          <Column id="CATEGORY_NAME" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CATEGORY_ID">1</Col>
            <Col id="CATEGORY_NAME">구이류</Col>
          </Row>
          <Row>
            <Col id="CATEGORY_ID">2</Col>
            <Col id="CATEGORY_NAME">식사류</Col>
          </Row>
          <Row>
            <Col id="CATEGORY_ID">3</Col>
            <Col id="CATEGORY_NAME">주류</Col>
          </Row>
          <Row>
            <Col id="CATEGORY_ID">4</Col>
            <Col id="CATEGORY_NAME">음료</Col>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
  </Form>
</FDL>
