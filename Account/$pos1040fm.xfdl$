<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="pos1040fm" width="1600" height="720" titletext="New Form" onload="pos1040fm_onload">
    <Layouts>
      <Layout height="720" width="1600">
        <Div id="Div00" taborder="0" left="554" top="35" width="493" height="651" formscrollbartype="none none" cssclass="div_card_shadow">
          <Layouts>
            <Layout>
              <Button id="btnIdCheck" taborder="0" text="중복확인" left="365" top="291" width="81" height="34" onclick="Div00_btnIdCheck_onclick" cssclass="btn_text_only"/>
              <TextField id="TxfId" taborder="1" labeltext="아이디" left="47" top="227" width="399" height="54" inputtype="email" usetrailingbutton="true" displaynulltext="example@naver.com"/>
              <TextField id="TxfPwd" taborder="2" labeltext="비밀번호" left="47" top="331" width="399" height="54" inputtype="password" useleadingbutton="false" usetrailingbutton="false" onchanged="Div00_TextField00_00_onchanged" displaynulltext="영문+숫자 8자 이상"/>
              <TextField id="TxfPwdCheck" taborder="3" labeltext="비밀번호 확인" left="47" top="395" width="399" height="54" inputtype="password" useleadingbutton="false" usetrailingbutton="false" onchanged="Div00_TextField00_00_onchanged" displaynulltext="영문+숫자 8자 이상"/>
              <Button id="btnPwdShow" taborder="4" text="보기" left="390" top="350" width="50" height="25" onclick="Div00_btnPwdShow_onclick"/>
              <Button id="btnPwdCheckShow" taborder="5" text="보기" left="390" top="414" width="50" height="25" onclick="Div00_btnPwdCheckShow_onclick"/>
              <TextField id="TxfName" taborder="6" labeltext="이름" left="46" top="163" width="399" height="54" inputtype="text" usetrailingbutton="false" displaynulltext="이름을 입력하세요."/>
              <Radio id="rdoRole" taborder="7" left="142" top="520" width="226" height="30" codecolumn="codecolumn" datacolumn="datacolumn" columncount="2" innerdataset="innerdataset" index="0" text="사용자" value="Admin">
                <Dataset id="innerdataset">
                  <ColumnInfo>
                    <Column id="codecolumn" size="256"/>
                    <Column id="datacolumn" size="256"/>
                  </ColumnInfo>
                  <Rows>
                    <Row>
                      <Col id="codecolumn">User</Col>
                      <Col id="datacolumn">사용자</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">Admin</Col>
                      <Col id="datacolumn">관리자</Col>
                    </Row>
                  </Rows>
                </Dataset>
              </Radio>
              <Button id="btnConfirm" taborder="8" text="확인" left="152" top="575" width="80" height="50" onclick="Div00_btnConfirm_onclick" cssclass="btn_login"/>
              <Button id="btnCancel" taborder="9" text="취소" left="262" top="575" width="80" height="50" onclick="Div00_btnCancel_onclick" cssclass="btn_login"/>
              <Static id="Static00_00" taborder="10" left="210" top="118" width="60" height="1" border="1px solid gainsboro"/>
              <Static id="Static01_03_02" taborder="11" text="회원가입" left="218" top="130" width="120" height="60" cssclass="sta_caption"/>
              <Div id="Div01_00" taborder="12" left="161" top="59" width="170" height="52" cssclass="logo"/>
              <TextField id="TxfNumber" taborder="13" labeltext="전화번호" left="47" top="459" width="399" height="54" inputtype="text" usetrailingbutton="false" displaynulltext="전화번호를 입력하세요." onchanged="Div00_TxfNumber_onchanged"/>
            </Layout>
          </Layouts>
        </Div>
      </Layout>
    </Layouts>
    <Script type="xscript5.1"><![CDATA[//중복체크를 하기위한 변수
this.isIdChecked = false; // 기본값은 '안함(false)'
this.id_count="";

//Form이 시작되면
this.pos1040fm_onload = function(obj:nexacro.Form,e:nexacro.LoadEventInfo)
{    
    // 행 개수가 0개일 때만(처음 로딩될 때만) 추가
    if (this.ds_account.rowcount == 0) {
        this.ds_account.addRow();
    }
};


//비밀번호 보기 버튼
this.Div00_btnPwdShow_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var isPassword = this.Div00.form.TxfPwd.inputtype;
	
	if(isPassword=="password"){
		this.Div00.form.TxfPwd.inputtype="text";
	}
	else{
		this.Div00.form.TxfPwd.inputtype="password";
	}
};

//비밀번호 확인 보기 버튼
this.Div00_btnPwdCheckShow_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var isPassword = this.Div00.form.TxfPwdCheck.inputtype;
	
	if(isPassword=="password"){
		this.Div00.form.TxfPwdCheck.inputtype="text";
	}
	else{
		this.Div00.form.TxfPwdCheck.inputtype="password";
	}
};


//<확인> DB로 보내기 및 정합성 체크
this.Div00_btnConfirm_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	// 정합성 체크
	this.gfnClearValidation(this.ds_account);
	this.gfnSetValidation(this.ds_account, "name", "이름","required");	
	this.gfnSetValidation(this.ds_account, "login_id", "아이디","required,isemail");
	this.gfnSetValidation(this.ds_account, "password", "비밀번호","required,minlength:8,nokorean,hasdigit");
	this.gfnSetValidation(this.ds_account, "passwordCheck", "비밀번호", "required,equalto:password");
	this.gfnSetValidation(this.ds_account, "number", "전화번호", "required,");
	this.gfnSetValidation(this.ds_account, "role", "사용자 유형","required");	
	
	
	// 수정된 Row만 Validation check
 	if (this.gfnValidation(this.ds_account, "U") == false) return;
	
	// 중복확인 버튼을 눌렀는지 체크
    if (this.isIdChecked == false) {
        this.gfnAlert("msg.account.id.check");
        return; 
    }

	//gdsAccount(회원가입 정보) 서버에 저장
	var sSvcId  = "svcSaveAccount";
	var sUrl    = "SvcUrl::pos/saveAccount.do";
	var inData  = "input_account=ds_account:U";
	var outData = ""; 
	var sParam  = "";
	this.gfnTransaction(sSvcId, sUrl, inData, outData, sParam, "fn_accountCallback");
};

// 회원가입 성공/실패 알람
this.fn_accountCallback = function(svcID, errorCode, errorMsg) {
	if (errorCode == 0) {
        // 성공했다면 전역 데이터셋(gdsAccount)에 유저 정보가 담겨 있음
        var ds =this.ds_account;
		var userName = ds.getColumn(ds.getRowCount() - 1, "name");

        this.gfnAlert("msg.account.success",[userName]);
        
        // 메인 화면으로 이동
        this.go("Account::pos1010fm.xfdl");
    } else {
       this.gfnAlert("msg.action.fail");
    }
};


//<취소> main화면으로 이동
this.Div00_btnCancel_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.go("Account::pos1010fm.xfdl");
};

//중복확인 체크
this.Div00_btnIdCheck_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{	 
    var sId   = this.Div00.form.TxfId.value;

    if (this.gfnIsNull(sId)) {
        this.gfnAlert("msg.account.id.required"); // "아이디를 입력해주세요."
        return;
    }
	
	var sSvcId  = "svcCheckId";
	var sUrl    = "SvcUrl::pos/checkId.do";
	var inData  = "";
	var outData = "";
	var sParam  = "loginId="+this.Div00.form.TxfId.value;
	
	this.gfnTransaction(sSvcId, sUrl, inData, outData, sParam, "fnCallback");
};
this.fnCallback=function(svcId, errCd, errMsg){

	if(svcId == "svcCheckId"){
        // 서버에서 받아온 id_count 변수 값 확인
        if(this.id_count > 0){
            // 아이디가 1개 이상 존재할 때
            this.gfnAlert("msg.account.id.duplicated"); //"이미 사용 중인 아이디입니다."
			this.isIdChecked = false; // 중복이면 다시 '안함' 상태로
        } else {
            // 아이디가 0개일 때
			this.gfnAlert("msg.account.id.available"); // "사용 가능한 아이디입니다."
			this.isIdChecked = true;
        }
    }
}


// this.Button00_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
// {
// 	var sSvcId  = "svcSelectAccout";
// 	var sUrl    = "SvcUrl::pos/selectAccout.do";
// 	var inData  = "";
// 	var outData = "gdsAccount=out_dataset";
// 	var sParam  = "loginId='wjdehddh03@naver.com'";
// 	this.gfnTransaction(sSvcId, sUrl, inData, outData, sParam, "fnCallback");
// };

]]></Script>
    <Bind>
      <BindItem id="item0" compid="Div00.form.TxfName" propid="value" datasetid="ds_account" columnid="name"/>
      <BindItem id="item1" compid="Div00.form.TxfId" propid="value" datasetid="ds_account" columnid="login_id"/>
      <BindItem id="item2" compid="Div00.form.TxfPwd" propid="value" datasetid="ds_account" columnid="password"/>
      <BindItem id="item3" compid="Div00.form.TxfPwdCheck" propid="value" datasetid="ds_account" columnid="passwordCheck"/>
      <BindItem id="item4" compid="Div00.form.rdoRole" propid="value" datasetid="ds_account" columnid="role"/>
      <BindItem id="item5" compid="Div00.form.TxfNumber" propid="value" datasetid="ds_account" columnid="number"/>
    </Bind>
    <Objects>
      <Dataset id="ds_account">
        <ColumnInfo>
          <Column id="login_id" type="STRING" size="256"/>
          <Column id="login_idCheck" type="STRING" size="256"/>
          <Column id="password" type="STRING" size="256"/>
          <Column id="passwordCheck" type="STRING" size="256"/>
          <Column id="name" type="STRING" size="256"/>
          <Column id="role" type="STRING" size="256"/>
          <Column id="number" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
  </Form>
</FDL>
